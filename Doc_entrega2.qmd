---
title: "Entrega 2"
author: 
  - name: √Ångel √Ålamo
  - name: Juanjo Doblas
  - name: √ìscar Vanrell 
format: html
editor: visual
execute:
  echo: false
---

# Gr√°ficos de la base de datos mpg

En esta pr√°ctica representaremos la informaci√≥n de la base de datos mpg a partir de gr√°ficos utilizando ggplot. Primero cargaremos la librer√≠a tidyverse y la tabla de datos.

```{r cargar tidyverse, include = FALSE, warning = FALSE}
library(tidyverse)
```

```{r mostrar variables}
mpg %>% glimpse

```

Convertimos todas las variables 'character' en factor.

```{r character a factor}
mpg2 <- mpg %>%
  mutate(across(where(is.character), as.factor), .keep = "all")

mpg2 %>% glimpse
```

## 1. Dibujad un gr√°fico que permita visualizar el n√∫mero de veh√≠culos de cada fabricante del conjunto de datos.

```{r num vehiculos por fabricante, fig.width = 10, fig.height = 5}

colores_degradados <- colorRampPalette(c("red", "yellow"))(length(unique(mpg2$manufacturer)))

mpg2 %>%
  ggplot(aes(x = manufacturer, fill = manufacturer)) +
  geom_bar() +
  labs(x = "Fabricante", y = "N√∫m. de veh√≠culos") + 
  theme_bw() +
  guides(fill = guide_legend(title = "Fabricante")) +
  theme(axis.title = element_text(face = "bold"),
        legend.title = element_text(size = 10, face = "bold")) + 
  scale_fill_manual(values = colores_degradados)
  

```

## 2. Dibujad un gr√°fico para mostrar el rendimiento medio en ciudad para cada clase.

```{r rendimiento ciudad por clases, fig.width = 7, fig.height = 4}

mpg2 %>% 
  group_by(class) %>% 
  summarise(cty_media = mean(cty), .groups = "drop") %>%
  ggplot() + 
  geom_col(aes(x = class, y = cty_media, fill = class)) +
  labs(x = "Tipo de veh√≠culo", y = "Rend. medio en ciudad (mpg) ") +
  theme_bw() + 
  guides(fill = guide_legend(title = "Clases de veh√≠culos")) +
  theme(axis.text = element_text(face = "bold"),
        axis.title = element_text(face = "bold"),
        legend.title = element_text(size = 10, face = "bold"))
```

## 3. Construid un gr√°fico para mostrar el rendimiento medio en ciudad para cada clase y tipo de tracci√≥n simult√°neamente.

```{r rendimiento ciudad por clases y tracci√≥n, fig.width = 10, fig.height = 4}

mpg2 %>% 
  group_by(class, drv) %>% 
  summarise(cty_media = mean(cty), .groups = "drop") %>%
  unite(col = "class_drv", c(class, drv), sep = " - ") %>%
  ggplot() + 
  geom_col(aes(x = class_drv, y = cty_media, fill = class_drv), alpha = 0.8,
           position = "identity", na.rm = TRUE) +
  labs(x = "Tipo de veh√≠culo y tracci√≥n", y = "Rend. medio en ciudad (mpg) ") +
  theme_bw() +
  theme(axis.text = element_text(size = 6)) +
  guides(fill = guide_legend(title = "Veh√≠culo - Tracci√≥n")) +
  theme(axis.title = element_text(face = "bold"),
        legend.title = element_text(size = 10, face = "bold"))


```
## 4. Utilizad un gr√°fico para mostrar la relaci√≥n entre el tama√±o del motor y el rendimiento en carretera, para cada clase de veh√≠culo. ¬øQu√© pod√©is observar?

```{r relacion tama√±o motor y rendimiento carretera, fig.width = 13, fig.height = 3}

mpg2 %>% 
  select(displ, hwy, class) %>% 
  relocate(class, .before = displ) %>%
  group_by(class) %>% 
  ggplot() + 
  geom_point(aes(x = displ, y = hwy, color = class), position = "identity",
             na.rm = TRUE) +
  facet_grid(.~class) +
  scale_fill_manual(values = c("green", "blue", "red",
                               "darkorange","purple","cyan4", "grey")) +
  labs(x = "Tama√±o del motor (L)", y = "Rend. en carretera (mpg)") +
  guides(fill = guide_legend(title = "Tipo de veh√≠culo")) +
  theme_bw() +
  theme(axis.title = element_text(face = "bold"),
        legend.title = element_text(size = 10, face = "bold"))
```
Aunque consideremos que la muestra sea peque√±a, podemos ver, en general, una correlaci√≥n negativa entre las dos variables, es decir, a m√°s tama√±o de motor, menos rendimiento en ciudad.

Sin embargo, para los gr√°ficos de las clases "2seater" y "minivan", no hay suficientes unidades muestrales como para sacar una relaci√≥n entre las dos variables, aunque podr√≠amos suponer que siguen la misma relaci√≥n que las otras clases.

## 5. Comparad la distribuci√≥n del rendimiento en ciudad para distintos tipos de tracci√≥n.

```{r distribucion rendimiento ciudad por tipo de traccion, fig.width = 10, fig.height = 4}

mpg2 %>%
  select(drv, cty) %>% 
  group_by(drv) %>% 
  ggplot() + 
  geom_histogram(aes(x = cty, fill = drv), alpha = 0.5, position = "identity",
                 na.rm = TRUE) +
  facet_grid(.~drv) +
  scale_fill_manual(values = c("darkorange","purple","cyan4")) +
  labs(x = "Rendimiento en ciudad (mpg)", y = "Frec. absoluta") +
  theme_bw() +
  guides(fill = guide_legend(title = "Traccci√≥n")) +
  theme(axis.title = element_text(face = "bold"),
        legend.title = element_text(size = 10, face = "bold"))
  

```

```{r comentarios}

# "	[38;5;250m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.[39m" sale en el html y habr√≠a que quitarlo
```


